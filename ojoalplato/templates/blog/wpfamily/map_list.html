{% extends "blog/wpfamily/base.html" %}
{% load static leaflet_tags content_filters %}

{% block css %}
    {{ block.super }}
    {% leaflet_css %}
    <link href="{% static 'bower_components/Leaflet.awesome-markers/dist/leaflet.awesome-markers.css' %}"
          rel="stylesheet" type="text/css" media="all"/>
    <link href="{% static 'bower_components/leaflet.fullscreen/Control.FullScreen.css' %}"
          rel="stylesheet" type="text/css" media="all"/>
    <style>

        .leaflet-container { /* all maps */
            width: 100%;
            height: 500px;
            position: relative;
            background-color: white;
            overflow: hidden;
        }

        .content-area {
            padding: 20px 0;
        }

        .has-family .content-area {
            padding-top: 160px;
        }

        .no-padding {
            padding-left: 0;
            padding-right: 0;
        }

    </style>

{% endblock css %}

{% block javascript %}
    {{ block.super }}
    {% leaflet_js %}
    <script src="{% static 'bower_components/Leaflet.awesome-markers/dist/leaflet.awesome-markers.min.js' %}"
            type="text/javascript"></script>
    <script src="{% static 'bower_components/leaflet.fullscreen/Control.FullScreen.js' %}"
            type="text/javascript"></script>
    <script type="text/javascript">
        var restIcon = L.AwesomeMarkers.icon({
            icon: 'cutlery',
            markerColor: 'blue'
        });
        window.addEventListener("map:init", function (e) {
            var detail = e.detail;
            detail.map.scrollWheelZoom.disable();
            {% for rest in object_list %}
                L.marker({{ rest.get_position_wgs84 }}, {icon: restIcon}).addTo(detail.map)
                        .bindPopup("<b>{{ rest.name }}</b> <br>\{% for post in rest.posts.all %}
                <a href='{{ post.get_absolute_url }}'>{{ post.title }}</a><br>\{% endfor %}
                ");
            {% endfor %}
            // create a fullscreen button and add it to the map
            L.control.fullscreen({
                position: 'topleft', // change the position of the button can be topleft, topright, bottomright or bottomleft, defaut topleft
                title: 'Pantalla completa', // change the title of the button, default Full Screen
                titleCancel: 'Salir de pantalla completa', // change the title of the button when fullscreen is on, default Exit Full Screen
                content: null, // change the content of the button, can be HTML, default null
                forceSeparateButton: false, // force seperate button to detach from zoom buttons, default false
                forcePseudoFullscreen: true, // force use of pseudo full screen even if full screen API is available, default false
                fullscreenElement: false // Dom element to render in full screen, false by default, fallback to map._container
            }).addTo(detail.map);
        }, false);
    </script>
{% endblock javascript %}

{% block content %}
    <!--div id="map" style="position: relative; background-color: white; overflow: hidden; height: 300px; width: 100%;"></div-->
    <div class="row">

    <div class="col-md-8 no-padding">
    {% leaflet_map "map" %}
    </div>

    <div class="col-md-4 no-padding">
        <!--article id="post-1" style="margin-top: 20px;"-->
        <article id="post-1"
                 class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry
                 category-friends family_blog_memberscat-maddie"
                 style="min-height: 500px;">

            <div class="article-padding has-family-list">
                <header class="entry-header">
                    <h2 class="entry-title" id="search"><a href="#search">Buscar restaurantes</a></h2>
                <div class="entry-content">


                <form method="get" action="{% url 'haystack_search' %}">
                    <table>

                        <input name="q" type="text" />
                        <tr>
                            <td>&nbsp;</td>
                            <td>
                                <input type="submit" value="Buscar">
                            </td>
                        </tr>
                    </table>

                    {% if query %}
                        <h3>Resultados:</h3>

                        {% for result in page.object_list %}
                        <div class="media row">
                              <div class="media-left col-md-2 col-xs-4">
                                <a href="{{ result.object.get_absolute_url }}">
                                 {% if result.object.image_header %}
                                     <img class="img-thumbnail img-responsive" src="{{ result.object.image_header.url|relative_url }}">
                                 {% else %}
                                     <img class="img-thumbnail img-responsive" src="{{ result.object.content|first_img }}">
                                 {% endif %}
                                </a>
                              </div>
                              <div class="col-md-10 col-xs-8">
                                  <h4 class="media-heading"><a href="{{ result.object.get_absolute_url }}">{{ result.object.title }}</a></h4>
                                        {% if result.object.chef %}<h5>{{ result.object.chef }}</h5>{% endif %}
                                        {% if result.object.address %}<h5>{{ result.object.address }}</h5>{% endif %}
                              </div>
                        </div>
                        {% empty %}
                            <p>No se han encontrado resultados.</p>
                        {% endfor %}

                        {% if page.has_previous or page.has_next %}
                            <div>
                                {% if page.has_previous %}<a href="?q={{ query }}&amp;page={{ page.previous_page_number }}">{% endif %}&laquo; Anterior{% if page.has_previous %}</a>{% endif %}
                                |
                                {% if page.has_next %}<a href="?q={{ query }}&amp;page={{ page.next_page_number }}">{% endif %}Siguiente &raquo;{% if page.has_next %}</a>{% endif %}
                            </div>
                        {% endif %}
                    {% else %}
                        {# Show some example queries to run, maybe query syntax, something else? #}
                    {% endif %}
                </form>
                </div>
            </div><!-- .entry-content -->
        </article>
    </div>

    </div> <!--row-->
{% endblock content %}
